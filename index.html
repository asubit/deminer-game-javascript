<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>JS</title>
    <script src="jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
    <table id="grid" border="1"></table>
    <div><a href="#" onclick="retry()">Retry</a></div>
    <div id="info"></div>
    <script>
      // Create grid
      var grid = $('#grid'), nbRow = 5, nbCol = 5;
      // add rows
      var row = 0;
      while (row < nbRow) {
        var rowId = 'row'+row;
        grid.append('<tr id="'+rowId+'"></tr>');
        // add cells in row
        var cell = 0;
        while (cell < nbCol) {
          var cellId = rowId+'-cell'+cell;
          $('tr#'+rowId).append('<td id="'+cellId+'"></td>');
          cell++;
        }
        row++;
      }

      // Place bombs
      var nbBombs = 5;
      bomb = 0;
      while (bomb < nbBombs) {
        var bombX = Math.floor((Math.random() * nbCol) + 1);
        var bombY = Math.floor((Math.random() * nbRow) + 1);
        grid.find('tr:nth-child('+bombY+') td:nth-child('+bombX+')').addClass('bomb');
        bomb++;
      }

      // Play
      grid.find('tr td').on('click', function(){
        isGameOver($(this));
        $(this).append(getNbBombsArround($(this)));
        $(this).addClass("clicked");
        $(this).off("click");
        isWin();
      });

      // Get bombs arround clicked cell
      function getNbBombsArround(cell) {
        var maxIndexX = parseInt(nbCol + 1), maxIndexY = parseInt(nbRow + 1);
        var nbBombsArround = 0;
        var cellCol = cell.index();
        var cellRow = cell.parent().index();
        // up left
        var upLeftX = parseInt(cellCol - 1), upLeftY = parseInt(cellRow - 1);
        if ((0 < upLeftX && upLeftX < maxIndexX) && (0 < upLeftY && upLeftY < maxIndexY)) {
          if (grid.find('tr:eq('+upLeftY+') td:eq('+upLeftX+')').hasClass('bomb')) {
            nbBombsArround++;console.log('bomb found in '+upLeftX+','+upLeftY);
          }
        }
        // up near
        var upNearX = parseInt(cellCol), upNearY = parseInt(cellRow - 1);
        if ((0 < upNearX && upNearX < maxIndexX) && (0 < upNearY && upNearY < maxIndexY)) {
          if (grid.find('tr:eq('+upNearY+') td:eq('+upNearX+')').hasClass('bomb')) {
            nbBombsArround++;console.log('bomb found in '+upNearX+','+upNearY);
          }
        }
        // up right
        var upRightX = parseInt(cellCol + 1), upRightY = parseInt(cellRow - 1);
        if ((0 < upRightX && upRightX < maxIndexX) && (0 < upRightY && upRightY < maxIndexY)) {
          if (grid.find('tr:eq('+upRightY+') td:eq('+upRightX+')').hasClass('bomb')) {
            nbBombsArround++;console.log('bomb found in '+upRightX+','+upRightY);
          }
        }
        // near left
        var nearLeftX = parseInt(cellCol - 1), nearLeftY = parseInt(cellRow);
        if ((0 < nearLeftX && nearLeftX < maxIndexX) && (0 < nearLeftY && nearLeftY < maxIndexY)) {
          if (grid.find('tr:eq('+nearLeftY+') td:eq('+nearLeftX+')').hasClass('bomb')) {
            nbBombsArround++;console.log('bomb found in '+nearLeftX+','+nearLeftY);
          }
        }
        // near right
        var nearRightX = parseInt(cellCol + 1), nearRightY = parseInt(cellRow);
        if ((0 < nearRightX && nearRightX < maxIndexX) && (0 < nearRightY && nearRightY < maxIndexY)) {
          if (grid.find('tr:eq('+nearRightY+') td:eq('+nearRightX+')').hasClass('bomb')) {
            nbBombsArround++;console.log('bomb found in '+nearRightX+','+nearRightY);
          }
        }
        // bottom left
        var bottomLeftX = parseInt(cellCol - 1), bottomLeftY = parseInt(cellRow + 1);
        if ((0 < bottomLeftX && bottomLeftX < maxIndexX) && (0 < bottomLeftY && bottomLeftY < maxIndexY)) {
          if (grid.find('tr:eq('+bottomLeftY+') td:eq('+bottomLeftX+')').hasClass('bomb')) {
            nbBombsArround++;console.log('bomb found in '+bottomLeftX+','+bottomLeftY);
          }
        }
        // bottom near
        var bottomNearX = parseInt(cellCol), bottomNearY = parseInt(cellRow + 1);
        if ((0 < bottomNearX && bottomNearX < maxIndexX) && (0 < bottomNearY && bottomNearY < maxIndexY)) {
          if (grid.find('tr:eq('+bottomNearY+') td:eq('+bottomNearX+')').hasClass('bomb')) {
            nbBombsArround++;console.log('bomb found in '+bottomNearX+','+bottomNearY);
          }
        }
        // bottom right
        var bottomRightX = parseInt(cellCol + 1), bottomRightY = parseInt(cellRow + 1);
        if ((0 < bottomRightX && bottomRightX < maxIndexX) && (0 < bottomRightY && bottomRightY < maxIndexY)) {
          if (grid.find('tr:eq('+bottomRightY+') td:eq('+bottomRightX+')').hasClass('bomb')) {
            nbBombsArround++;console.log('bomb found in '+bottomRightX+','+bottomRightY);
          }
        }
        return nbBombsArround;
      }

      function isWin() {
        var clickedCells = parseInt(grid.find('td.clicked').length);
        var bomCells = parseInt(grid.find('td.bomb').length);
        var totalCells = parseInt(grid.find('td').length);
        if (parseInt(clickedCells+bomCells) == totalCells) {
          $('#info').append('WIN!');
        }
      }

      function isGameOver(cell) {
        if (cell.hasClass('bomb')) {
          grid.find('td.bomb').addClass('bomb-explode');
          $('#info').append('BOUM!');
        }
      }

      function retry() {
        location.reload();
      }
    </script>
</body>

</html>
